<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe</title>

    <!-- Google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap');

        *, *::before, *::after {
            margin: 0;  padding: 0;
            box-sizing: border-box;
        }

        :root {
            --title-colo1: #DCBF3F;
            --title-color2: #72CFF9;

            --big-bg: #2B0040;
            --cell-bg: #43115B;
            --main-bg: #5A1E76;

            --top-bg1: #48D2FE;
            --top-bg2: #BCDBF9;
            --top-bg3: #E2BE00;
        }

        body {
            background-color: var(--main-bg);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Fredoka', Arial, sans-serif;
        }

        main {
            background-color: var(--big-bg);
            min-width: 240px;   height: 400px;
            border-radius: 10px;
            padding: 5px;
            text-align: center;
        }

        main h1 {
            color: var(--title-color2);
            padding-bottom: 10px;
            
        }

        main h1 span {
            color: var(--title-colo1);
        }

        #scores {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 0 20px 30px 20px;
        }

        #scores .box {
            width: 50px;    height: 50px;
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font: 16px monospace;
        }

        .box:nth-child(1) {background-color: var(--top-bg1)}
        .box:nth-child(2) {background-color: var(--top-bg2)}
        .box:nth-child(3) {background-color: var(--top-bg3)}

        #board,
        #setting {
            width: 100%;
            padding: 0 30px 30px 30px;
        }

        .hide {
            display: none !important;
        }

        #board button:disabled {
            background-color: #320c44;
            /* border: 1px solid var(--title-color2); */
        }

        #board button {
            border: none;
            outline: none;
            width: 50px; 
            height: 50px;
            border-radius: 5px;
            background-color: var(--cell-bg);
            font-family: 'Fredoka', Arial, sans-serif;
            cursor: pointer;
            font-size: 40px;
            font-weight: 600;
        }

        #board button:not(:empty) {
            margin-bottom: 4px;
        }

        #setting1 button {
            border: none;
            border-radius: 4px;
            background-color: #fff;
            color: #000;
            padding: 8px 12px;
            font-family: 'Fredoka', Arial, sans-serif;
            font-weight: 500;
            cursor: pointer;
        }

        #setting1 button:disabled {
            opacity: 40%;
        }

        #turn {
            display: inline-block;
            border-radius: 4px;
            background-color: #fff;
            color: #000;
            padding: 4px 12px;
            font-family: 'Fredoka', Arial, sans-serif;
            font-weight: 500;
        }

    </style>
</head>
<body>

    <main>
        <h1>tic <span>tac</span> toe</h1>

        <div id="scores">
            <div class="box">
                <h6>player</h6>
                <span id="player-score">0</span>
            </div>
            <div class="box">
                <h6>draw</h6>
                <span id="draw">0</span>
            </div>
            <div class="box">
                <h6>opponent</h6>
                <span id="opponent-score">0</span>
            </div>
        </div>

        <table id="board">
            <tr>
                <td><button></button></td>
                <td><button></button></td>
                <td><button></button></td>
            </tr>
            <tr>
                <td><button></button></td>
                <td><button></button></td>
                <td><button></button></td>
            </tr>
            <tr>
                <td><button></button></td> 
                <td><button></button></td>
                <td><button></button></td>
            </tr>
        </table>

        <div id="setting1">
            <button onclick="Play(this)">Multiplayers</button>
            <button onclick="Play(this)" disabled>AI</button>
        </div>

        <div id="setting2" class="hide">
            <button onclick="Play(this)">Try Again</button>
            <button onclick="Play(this)">New Game</button>
        </div>

        <div id="turn" class="hide"></div>

        
    </main>

    <script>
        let characters = ['X', 'O'];
        let teamColors = ['#48D2FE', '#E2BE00']
        const btnLst = document.querySelectorAll("td button");
        disableAllButton(true);
 
        function disableAllButton(condition) {
            for (let btn of btnLst) {
                btn.disabled = condition;
            }
        };

        const setting1 = document.getElementById('setting1');
        const setting2 = document.getElementById('setting2');
        function Play(type) {
            setting1.classList.toggle("hide");

            let gamePlay = type.innerHTML;
            if (gamePlay === 'Multiplayers') {
                gameLoop();
            }
        };

        function gameLoop() {
            disableAllButton(false);

            let random = Math.floor(Math.random() * 10) % 2;
            let player = characters[random];
            let color = teamColors[random];
            displayPlayer(player, color);

            for (let btn of btnLst) {
                btn.addEventListener('click', () => {

                    btn.style.color = color;
                    btn.innerHTML = player;
                    btn.disabled = true;

                    if (evaluate(player, color)) {
                        disableAllButton(true);

                        return;
                    }

                    if (player === characters[0]) {
                        player = characters[1];
                        color = teamColors[1];
                    } else {
                        player = characters[0];
                        color = teamColors[0];
                    }

                    displayPlayer(player, color);
                });
            };
        };

        const div = document.getElementById('turn');
        function displayPlayer(character, color, State=false) {
            if (State === 'win') {
                div.innerHTML = `player <span>${character}</span> win`;
                const span = document.querySelector('#turn span');
                span.style.color = color;
                return;
            }
            else if (State === 'draw') {
                div.innerHTML = `It\'s a draw!`;
                return;
            }

            div.classList.remove('hide');
            div.innerHTML = `It\'s player <span>${character}</span> turn`;
            const span = document.querySelector('#turn span');
            span.style.color = color;
        }

        const winningCombination = [
            [0, 1, 2], // Top row
            [3, 4, 5], // Middle row
            [6, 7, 8], // Bottom row
            [0, 3, 6], // Left column
            [1, 4, 7], // Middle column
            [2, 5, 8], // Right column
            [0, 4, 8], // Diagonal from top-left to bottom-right
            [2, 4, 6]  // Diagonal from top-right to bottom-left
        ];
        function CheckWin() {
            for (const comb of winningCombination) {
                const [a, b, c] = comb;
                const buttonA = btnLst[a];
                const buttonB = btnLst[b];
                const buttonC = btnLst[c];
                
                if (buttonA.textContent && buttonA.textContent === buttonB.textContent && buttonA.textContent === buttonC.textContent) {
                    return buttonA.textContent;
                }
            }
        };

        function draw() {
            for (let btn of btnLst) {
                if (btn.textContent.length === 0) {
                    return false;
                }
            }
            return true;
        }

        function evaluate(character, color) {
            let winner = CheckWin();

            if (winner) {
                let plScorer = document.getElementById('player-score');
                let enScorer = document.getElementById('opponent-score');

                displayPlayer(character, color, 'win')

                if (winner === 'X') {
                    plScorer.textContent = parseInt(plScorer.textContent) + 1;
                    return true;
                } else {
                    enScorer.textContent = parseInt(enScorer.textContent) + 1;
                    return true;
                }
            }
            else if (draw()) {
                displayPlayer(character, color, 'draw')

                let drawScorer = document.getElementById('draw');
                drawScorer.textContent = parseInt(drawScorer.textContent) + 1;
                return true;
            }

            return false;
        }
 
    </script>
</body>
</html>